<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Atticus</title>
<link rel="stylesheet" href="/static/css/theme.modern.css">
</head>
<body>
<div class="app">
  <aside class="side">
    <h2>Menu</h2>
    <button id="contact-btn" class="btn primary">CONTACT</button>
  </aside>
  <main class="main">
    <header><h1>Atticus</h1></header>
    <section id="hero" class="hero">
      <h2>What can I help with?</h2>
      <div class="row">
        <input id="chat-input" placeholder="Ask Atticus…">
        <button id="chat-send" class="btn">↗</button>
      </div>
    </section>
    <section class="chat" id="chat">
      <div id="chat-stream" class="stream"></div>
      <div class="composer">
        <input id="chat-input-bottom" placeholder="Ask Atticus…">
        <button id="chat-send-bottom" class="btn primary">Send</button>
      </div>
    </section>
  </main>
</div>
<script>
(function(){
  const chat = document.getElementById('chat');
  const hero = document.getElementById('hero');
  const stream = document.getElementById('chat-stream');
  function append(role, text){
    hero.style.display='none'; chat.style.display='grid';
    const d=document.createElement('div'); d.className='msg '+role;
    d.textContent=text; stream.appendChild(d); stream.scrollTop=stream.scrollHeight;
  }
  async function sendFrom(input){
    const t=input.value.trim(); if(!t) return;
    append('user', t); input.value='';
    try{
      const r=await fetch('/ask',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({query:t})});
      const data=await r.json(); append('agent', data.answer||'(no answer)');
    }catch(e){ append('agent','Network error'); }
  }
  function wire(input, btn){
    btn.addEventListener('click',()=>sendFrom(input));
    input.addEventListener('keydown',e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendFrom(input);}});
  }
  wire(document.getElementById('chat-input'),document.getElementById('chat-send'));
  wire(document.getElementById('chat-input-bottom'),document.getElementById('chat-send-bottom'));
  document.getElementById('contact-btn').addEventListener('click',async()=>{
    try{await fetch('/contact',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({reason:'user_clicked_contact'})});alert('We have emailed support.');}
    catch(e){alert('Failed to send contact request.');}
  });
  chat.style.display='none';
})();
</script>
</body>
</html>
